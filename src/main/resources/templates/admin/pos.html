<!-- templates/admin/pos.html -->
<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<div class="container-fluid py-3" layout:fragment="content">
  <style>
    .product-card img { height: 160px; object-fit: cover; background: #f3f4f6; }
    .sticky-col { position: sticky; top: 12px; }
    .qty-btn { width: 36px; height: 36px; padding: 0; }
    .card-soft { border: 0; box-shadow: 0 6px 18px rgba(0,0,0,.06); border-radius: 16px; }
    .badge-soft { background: #f1f5f9; color: #0f172a; }
    .cart-item { border: 1px solid #eef2f7; border-radius: 12px; padding: 10px; }
    .cart-title { font-weight: 600; }
    .cart-sub { font-size: 12px; color: #64748b; }
  </style>

  <div class="row g-3">

    <!-- LEFT: Products -->
    <div class="col-12 col-lg-8">
      <div class="card card-soft">
        <div class="card-body">

          <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
            <div>
              <h5 class="mb-0">POS</h5>
              <div class="small text-muted">USD only</div>
            </div>

            <div class="ms-auto d-flex gap-2 flex-wrap">
              <input id="q" class="form-control" style="min-width:240px" placeholder="Search products..."/>
              <button class="btn btn-primary" id="btnSearch" type="button">Search</button>
            </div>
          </div>

          <div id="productsGrid" class="row g-3"></div>

          <div class="d-flex justify-content-between align-items-center mt-3">
            <button class="btn btn-outline-secondary btn-sm" id="prevBtn" type="button">Prev</button>
            <div class="small text-muted" id="pageInfo">Page 1</div>
            <button class="btn btn-outline-secondary btn-sm" id="nextBtn" type="button">Next</button>
          </div>

        </div>
      </div>
    </div>

    <!-- RIGHT: Cart + Checkout -->
    <div class="col-12 col-lg-4">
      <div class="card card-soft sticky-col">
        <div class="card-header bg-primary text-white d-flex align-items-center gap-2"
             style="border-top-left-radius:16px;border-top-right-radius:16px;">
          <span class="fw-bold">Shopping Cart</span>
          <span class="ms-auto badge badge-soft">USD ($)</span>
        </div>

        <div class="card-body">

          <div id="cartList" class="vstack gap-3"></div>
          <hr/>

          <div class="d-flex justify-content-between">
            <div class="text-muted">Subtotal</div>
            <div class="fw-semibold">$<span id="subtotal">0.00</span></div>
          </div>

          <div class="d-flex justify-content-between mt-2">
            <div class="text-muted">Extra Discount</div>
            <div class="fw-semibold text-danger">- $<span id="discountShow">0.00</span></div>
          </div>

          <div class="d-flex justify-content-between mt-3 fs-5">
            <div class="fw-bold">Total</div>
            <div class="fw-bold text-primary">$<span id="total">0.00</span></div>
          </div>

          <hr/>

          <div class="mb-2">
            <label class="form-label">Customer Name <span class="text-danger">*</span></label>
            <input id="customerName" class="form-control" placeholder="Enter customer name"/>
          </div>

          <div class="mb-2">
            <label class="form-label">Phone (optional)</label>
            <input id="phone" class="form-control" placeholder="Enter phone number"/>
          </div>

          <div class="mb-2">
            <label class="form-label">Address (optional for POS)</label>
            <input id="address" class="form-control" placeholder="Enter address"/>
          </div>

          <div class="mb-2">
            <label class="form-label">Extra Discount ($)</label>
            <input id="extraDiscount" class="form-control" value="0"/>
          </div>

          <div class="mb-3">
            <label class="form-label">Payment Method</label>
            <select id="paymentMethod" class="form-select">
              <option value="CASH">CASH</option>
              <option value="KHQR">KHQR</option>
            </select>
          </div>

          <button id="btnComplete" class="btn btn-success w-100" type="button">
            âœ… Complete Order
          </button>

          <button id="btnClear" class="btn btn-outline-danger w-100 mt-2" type="button">
            ðŸ—‘ Clear Cart
          </button>

        </div>
      </div>
    </div>

  </div>

  <!-- KHQR POPUP MODAL -->
  <div class="modal fade" id="khqrModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius:16px;">
        <div class="modal-header">
          <h5 class="modal-title">Scan to Pay (KHQR)</h5>
          <button type="button" class="btn-close btnCancelKhqr"></button>
        </div>

        <div class="modal-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="small text-muted">Invoice: <span id="khqrInvoice">-</span></div>
            <div class="fw-bold">$<span id="khqrAmount">0.00</span></div>
          </div>

          <div class="d-flex justify-content-center">
            <div id="khqrQrBox" style="padding:10px;border:2px solid #ef4444;border-radius:12px;"></div>
          </div>

          <!-- âœ… Time left -->
          <div class="d-flex justify-content-center mt-2">
            <div class="small text-muted">
              Time left: <span id="khqrTimeLeft" class="fw-semibold">03:00</span>
            </div>
          </div>

          <div id="khqrHint" class="text-muted mt-3 text-center">Waiting for payment...</div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-danger w-100 btnCancelKhqr">Cancel Payment</button>
        </div>
      </div>
    </div>
  </div>

  <!-- QRCode lib (required) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <!-- Your POS JS -->
  <script th:src="@{/js/pos.js}"></script>
</div>

</html>